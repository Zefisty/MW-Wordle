<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Warships Wordle</title>
<style>
body{background:#0b1a2a;color:white;font-family:Arial,sans-serif;text-align:center;padding:20px;margin:0;}
.top{display:flex;justify-content:space-between;margin-bottom:10px;}
.box{background:#1b2b3a;border:2px solid #555;padding:8px 12px;border-radius:6px;font-size:16px;}
.lang button{background:none;border:none;color:white;cursor:pointer;padding:4px 8px;font-size:14px;}
.lang button.active{background:#3a7bd5;border-radius:4px;}
h1{margin:10px 0 14px;font-size:26px}
#timer{font-size:28px;font-weight:bold;margin-bottom:16px;}
button{cursor:pointer;border:none;border-radius:6px;font-size:18px;padding:10px 18px;background:#3a7bd5;color:white;}
#hintBtn{margin-bottom:12px;}
#surrender,#playAgain{margin-top:12px;display:none;}
.hints{display:flex;justify-content:center;gap:12px;margin-bottom:16px;}
.hint-square{width:90px;height:90px;border-radius:8px;background:#1b2b3a;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:16px;flex-direction:column;transition:0.5s;}
.hint-square.used{background:#6aaa64;color:white;}
.input-container{display:flex;justify-content:center;margin-bottom:8px;}
#guessInput{
  width:300px;padding:14px;font-size:16px;background:#1b2b3a;color:white;
  border:2px solid #555;border-radius:8px;text-align:center;
}
#guessInput::placeholder{color:#aaa;}
.auto{
  position:absolute;background:#1b2b3a;border:2px solid #555;border-radius:8px;
  text-align:left;overflow:hidden;display:none;z-index:5;
}
.auto div{padding:8px;cursor:pointer;border-radius:8px;transition:background 0.2s;}
.auto div:hover{background:#3a7bd5;}
.board{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:14px;}
.grid{display:flex;justify-content:center;gap:12px;margin-bottom:12px;}
.square{width:90px;height:90px;border-radius:8px;font-size:16px;font-weight:bold;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4px;word-break:break-word;border:2px solid #555;opacity:1;}
.square.reveal{opacity:0;transform:scale(0.85);animation:reveal .35s ease forwards;}
.label{background:#1b2b3a;}
.green{background:#6aaa64;color:white;}
.red{background:#d9534f;color:white;}
.orange{background:#f0ad4e;color:white;}
.col{display:flex;flex-direction:column;align-items:center;gap:3px;}
@keyframes reveal{to{opacity:1;transform:scale(1);}}

/* –û—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
#attempts, .input-container, #surrender, #playAgain, .hints{margin-top:6px;}
</style>
</head>
<body>
<div class="top">
  <div class="box" id="streak">üî• –°–µ—Ä–∏—è: 0</div>
  <div class="box lang">
    <button data-lang="ru" class="active">RU</button>
    <button data-lang="en">EN</button>
  </div>
</div>

<h1 id="title">üö¢ Modern Warships Wordle</h1>
<div id="timer">00:00</div>

<button id="hintBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∞ üí°</button>

<div class="hints">
  <div class="hint-square" data-index="0">üí°</div>
  <div class="hint-square" data-index="1">üí°</div>
  <div class="hint-square" data-index="2">üí°</div>
</div>

<div class="input-container">
  <input id="guessInput" placeholder="–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è" autocomplete="off">
</div>
<div id="auto" class="auto"></div>
<div id="attempts"></div>

<div class="board">
  <div id="labels" class="grid"></div>
  <div id="history"></div>
</div>

<div style="margin-top:12px;">
  <button id="surrender">–°–¥–∞—Ç—å—Å—è</button>
  <button id="playAgain">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

<script>
const T={
ru:{labels:["–°—Ç—Ä–∞–Ω–∞","–¢–∏—Ä","–†–µ–¥–∫–æ—Å—Ç—å","–ö–ª–∞—Å—Å","–ì–æ–¥","–í–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ","–î–ª–∏–Ω–∞","–®–∏—Ä–∏–Ω–∞"],attempts:"–ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å",win:"üéâ –¢—ã —É–≥–∞–¥–∞–ª –∑–∞",lose:"‚õî –ö–æ—Ä–∞–±–ª—å –±—ã–ª",hints:["–¢–∏—Ä","–†–µ–¥–∫–æ—Å—Ç—å","–ö–ª–∞—Å—Å"],hintBtn:"–ü–æ–¥—Å–∫–∞–∑–∫–∞ üí°",streak:"üî• –°–µ—Ä–∏—è",surrender:"–°–¥–∞—Ç—å—Å—è",again:"–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"},
en:{labels:["Country","Tier","Rarity","Class","Year","Displacement","Length","Width"],attempts:"Attempts left",win:"üéâ You guessed in",lose:"‚õî Ship was",hints:["Tier","Rarity","Class"],hintBtn:"Hint üí°",streak:"üî• Streak",surrender:"Surrender",again:"Play again"}
};

let ships = [];
let dataLoaded = false;

fetch("ships.json")
  .then(res => {
    if (!res.ok) throw new Error("ships.json not found");
    return res.json();
  })
  .then(data => {
    ships = data;
    dataLoaded = true;
    start(); // –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  })
  .catch(err => {
    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∫–æ—Ä–∞–±–ª–µ–π");
    console.error(err);
  });

let lang="ru",secret,attempts=6,guesses=[],hintCount=0,streak=Number(localStorage.getItem("streak")||0),startTime=null,timerInt=null,firstGuessMade=false;
const $=id=>document.getElementById(id);

function fmt(ms){
  const s=Math.floor(ms/1000);
  return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0");
}

function cmp(v,c,num=false){let col="red",i="‚ùå";if(v===c){col="green";i="‚úÖ";}else if(num){col="orange";i=v>c?"‚¨áÔ∏è":"‚¨ÜÔ∏è";}return {v,col,i};}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function render(skipAnimation=false){
  $("labels").innerHTML="";
  T[lang].labels.forEach(l=>{
    const d=document.createElement("div");
    d.className="square label";
    d.textContent=l;
    $("labels").appendChild(d);
  });
  $("attempts").textContent=T[lang].attempts+": "+attempts;
  $("streak").textContent=T[lang].streak+": "+streak;

  $("history").innerHTML="";
  guesses.forEach((ship,idx)=>{
    const row=document.createElement("div");row.className="grid";
    [
      cmp(ship.country[lang],secret.country[lang]),
      cmp(ship.tier,secret.tier,true),
      cmp(ship.rarity[lang],secret.rarity[lang]),
      cmp(ship.class[lang],secret.class[lang]),
      cmp(ship.year,secret.year,true),
      cmp(ship.displacement,secret.displacement,true),
      cmp(ship.length,secret.length,true),
      cmp(ship.width,secret.width,true)
    ].forEach((c,i)=>{
      const col=document.createElement("div");col.className="col";
      const sq=document.createElement("div");sq.className="square "+c.col;
      sq.innerHTML=c.v+" "+c.i;
      if(idx===guesses.length-1 && !skipAnimation) sq.classList.add("reveal");
      col.appendChild(sq);row.appendChild(col);
    });
    $("history").appendChild(row);
  });

  const keys=["tier","rarity","class"];
  document.querySelectorAll(".hint-square").forEach((sq,i)=>{
    if(i<hintCount){let value=keys[i]==="tier"?secret.tier:secret[keys[i]][lang];sq.textContent=T[lang].hints[i]+": "+value;sq.classList.add("used");}
    else{sq.textContent="üí°";sq.classList.remove("used");}
  });
}

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä—è–¥–∞
function animateLastRow(callback){
  const lastRow=$("history").lastElementChild;
  if(!lastRow){callback(); return;}
  const squares=Array.from(lastRow.querySelectorAll(".square"));
  squares.forEach((sq,i)=>{
    sq.style.opacity=0;
    sq.style.transform="scale(0.85)";
    setTimeout(()=>{
      sq.classList.add("reveal");
      if(i===squares.length-1){
        setTimeout(callback,350);
      }
    }, i*150);
  });
}

// –¢–∞–π–º–µ—Ä
function startTimer(){
  if(startTime) return;
  startTime = Date.now();
  timerInt = setInterval(()=>{$("timer").textContent=fmt(Date.now()-startTime)},1000);
}
function stopTimer(){clearInterval(timerInt);}

// –§—É–Ω–∫—Ü–∏—è —É–≥–∞–¥—ã–≤–∞–Ω–∏—è
function guessShip(name){
  const ship=ships.find(s=>s.name.toLowerCase()===name.toLowerCase());
  if(!ship) return;

  if(!firstGuessMade){firstGuessMade=true;$("surrender").style.display="inline-block"; startTimer();}
  attempts--; guesses.push(ship); $("guessInput").value=""; $("auto").style.display="none";

  render(true);
  animateLastRow(()=>{
    if(ship.name===secret.name){
      stopTimer(); streak++; localStorage.setItem("streak",streak); attempts=0;
      $("surrender").style.display="none"; $("playAgain").style.display="inline-block";
      alert(T[lang].win+" "+fmt(Date.now()-startTime));
    } else if(attempts===0){
      stopTimer(); streak=0; localStorage.setItem("streak",0);
      $("surrender").style.display="none"; $("playAgain").style.display="inline-block";
      alert(T[lang].lose+" "+secret.name);
    }
  });
}

// –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
$("guessInput").oninput=()=>{
  const v=$("guessInput").value.toLowerCase(); $("auto").innerHTML="";
  if(!v){$("auto").style.display="none";return;}
  ships.filter(s=>s.name.toLowerCase().startsWith(v)).forEach(s=>{
    const d=document.createElement("div"); d.textContent=s.name;
    d.onclick=()=>{guessShip(s.name);}
    $("auto").appendChild(d);
  });
  if($("auto").children.length){
    $("auto").style.display="block";
    const r=$("guessInput").getBoundingClientRect();
    $("auto").style.top=(r.bottom+6+window.scrollY)+"px";
    $("auto").style.left=(r.left+window.scrollX)+"px";
    $("auto").style.width=r.width+"px";
  } else $("auto").style.display="none";
};

// –ü–æ–¥—Å–∫–∞–∑–∫–∏ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
$("hintBtn").onclick=()=>{if(hintCount>=3)return;hintCount++; render(true);};

// –°–¥–∞—Ç—å—Å—è
$("surrender").onclick=()=>{
  stopTimer(); streak=0; localStorage.setItem("streak",0); attempts=0;
  render(true);
  $("surrender").style.display="none"; $("playAgain").style.display="inline-block";
  alert(T[lang].lose+" "+secret.name);
};

// –°–º–µ–Ω–∞ —è–∑—ã–∫–∞
document.querySelectorAll(".lang button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".lang button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    lang=b.dataset.lang;
    $("guessInput").placeholder = lang==="ru" ? "–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è" : "Type ship name";
    $("hintBtn").textContent=T[lang].hintBtn;
    $("playAgain").textContent=T[lang].again;
    $("surrender").textContent=T[lang].surrender;
    render(true);
  };
});

// –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
$("playAgain").onclick=start;

// –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
function start(){
  secret=ships[Math.floor(Math.random()*ships.length)];
  attempts=6; guesses=[]; hintCount=0; firstGuessMade=false;
  startTime=null; stopTimer(); $("timer").textContent="00:00";
  $("playAgain").style.display="none"; $("surrender").style.display="none";
  render();
}
start();
</script>
</body>
</html>

